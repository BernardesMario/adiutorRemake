from django import forms
from .models import Appointment

class AppointmentForm(forms.ModelForm):
    class Meta:
        model = Appointment
        fields = ['client_number', 'appointment_date']  # Add other fields as needed

    def clean_appointment_date(self):
        cleaned_data = super().clean()
        client_number = cleaned_data.get('client_number')
        appointment_date = cleaned_data.get('appointment_date')

        if client_number and appointment_date:
            # Check if there are any existing appointments for the same client
            last_appointment = Appointment.objects.filter(
                client_number=client_number
            ).order_by('-appointment_date').first()

            if last_appointment and appointment_date < last_appointment.appointment_date:
                raise forms.ValidationError("Appointment date cannot be earlier than the last appointment.")

        return appointment_date
